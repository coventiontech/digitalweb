var Core=window.Core||{};Core.Drip=Core.Drip||function(e,t,a){"use strict";var i=function(t){var a=e.createElement("input");return a.type="email",a.required=!0,a.value=t,"function"==typeof a.checkValidity?a.checkValidity():/\S+@\S+\.\S+/.test(t)},n={visitor_uuid:"",vistor_phone:!1,init:function(){a(e).ready(n.ready)},ready:function(){n.bindCheckoutEvents(),n.checkCookies()},bindCheckoutEvents:function(){if("undefined"!=typeof _dcq){var t=a("body"),r=a("#edd-email");t.hasClass("upgrade-purchase")&&""!==r.val()&&_dcq.push(["identify",{email:r.val(),abandoned_cart_url:n.edd.getAbandonmentURL(),tags:[drip.tag_prefix+"-upgrade-to-"+drip.checkout_product_slug]}]),a(".edd-sl-renewal-details").length>0&&""!==r.val()&&_dcq.push(["identify",{email:r.val(),abandoned_cart_url:n.edd.getAbandonmentURL(),tags:[drip.tag_prefix+"-renewal-intent"]}]),t.hasClass("logged-in")||(r.on("blur",(function(){var e=a(this).val();if(n.edd.getPlanId()>0&&i(e)){var t={email:e,abandoned_cart_url:n.edd.getAbandonmentURL(),tags:[drip.tag_prefix+"-abandoned",n.edd.getPlan()],success:function(e){e.visitor_uuid&&(n.visitor_uuid=e.visitor_uuid,n.setCookie("awp_drip_visitor_uuid",n.visitor_uuid,30))}};n.visitor_uuid&&(delete t.email,t.new_email=e),_dcq.push(["identify",t])}})),a(e).on("phoneUpdate",(function(e,t){n.vistor_phone=t;var a=t,r=n.edd.getEmail();a&&i(r)&&_dcq.push(["identify",{email:r,phone:a,abandoned_cart_url:n.edd.getAbandonmentURL()}])})),a("#edd-user-login").on("blur",(function(){var e=n.edd.getName("username"),t=n.edd.getEmail();e.length&&i(t)&&_dcq.push(["identify",{email:t,username:e,abandoned_cart_url:n.edd.getAbandonmentURL()}])})),a("#edd-first").on("blur",(function(){var e=n.edd.getName("first"),t=n.edd.getEmail();e.length&&i(t)&&_dcq.push(["identify",{email:t,first_name:e,abandoned_cart_url:n.edd.getAbandonmentURL()}])})),a("#edd-last").on("blur",(function(){var e=n.edd.getName("last"),t=n.edd.getEmail();e.length&&i(t)&&_dcq.push(["identify",{email:t,last_name:e,abandoned_cart_url:n.edd.getAbandonmentURL()}])})))}},edd:{getEmail:function(){var e=a("#edd-email");return e.length?e.val():""},getPhone:function(){return n.vistor_phone?n.vistor_phone:""},getPlan:function(){return drip.checkout_product_slug?drip.tag_prefix+"-"+drip.checkout_product_slug:""},getPlanId:function(){var e=0;if(!a("#edd_checkout_cart").length)return e;var t=a("#edd_checkout_cart .edd_cart_item").first().data("download-id");return void 0!==t&&(e=parseInt(t,10)),e},getPriceId:function(){var e=0;if(!a("#edd_checkout_cart").length)return e;var t=a("#edd_checkout_cart .edd_cart_item").first().data("price-id");return void 0!==t&&(e=parseInt(t,10)),e},getDiscount:function(){return a(".edd_discount_remove").length?a(".edd_discount_remove").attr("data-code"):""},getName:function(e){var t="";if(!a("#edd_purchase_form").length)return t;switch(e){case"username":var i=a("#edd-user-login");t=i.length?i.val():"";break;case"first":var n=a("#edd-first");t=n.length?n.val():"";break;case"last":var r=a("#edd-last");t=r.length?r.val():"";break;case"full":t=this.getName("first")+" "+this.getName("last")}return a.trim(t)},getAbandonmentURL:function(){var e=new URL(drip.checkout_url);return e.searchParams.set("nocache",1),e.searchParams.set("edd_action","add_to_cart"),e.searchParams.set("download_id",this.getPlanId()),e.searchParams.set("edd_options[price_id]",this.getPriceId()),e.searchParams.set("discount",this.getDiscount()),e.searchParams.set("cemail",this.getEmail()),e.searchParams.set("clogin",this.getEmail()),e.searchParams.set("cfname",this.getName("first")),e.searchParams.set("clname",this.getName("last")),e.searchParams.set("cphone",this.getPhone()),e}},checkCookies:function(){var e=n.getCookie("awp_drip_visitor_uuid");e&&(n.visitor_uuid=e)},getCookie:function(t){var a=e.cookie.match("(^|;) ?"+t+"=([^;]*)(;|$)");return a?a[2]:null},setCookie:function(t,a,i){var n="";if(i){var r=new Date;r.setTime(r.getTime()+24*i*60*60*1e3),n="; expires="+r.toUTCString()}e.cookie=t+"="+(a||"")+n+"; path=/; samesite=strict"}};return n}(document,window,jQuery),Core.Drip.init();
